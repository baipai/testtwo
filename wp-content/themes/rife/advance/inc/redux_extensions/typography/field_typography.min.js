!function(a){"use strict";redux.field_objects=redux.field_objects||{},redux.field_objects.typography=redux.field_objects.typography||{};var b=[],c=!1,d={width:"resolve",triggerChange:!0,allowClear:!0};a(document).ready(function(){}),redux.field_objects.typography.init=function(e,f){e||(e=a(document).find(".redux-group-tab:visible").find(".redux-container-typography:visible")),a(e).each(function(){var e=a(this),f=e;if(e.hasClass("redux-field-container")||(f=e.parents(".redux-field-container:first")),!f.is(":hidden")&&f.hasClass("redux-field-init")){f.removeClass("redux-field-init");var g;e.each(function(){a(this).find(".redux-typography-container").each(function(){var b=a(this).find(".redux-typography-family");void 0===b.data("value")?b=a(this):""!==b.data("value")&&a(b).val(b.data("value"));var c=a(this).find(".select2_params");if(c.size()>0){var e=c.val();e=JSON.parse(e),d=a.extend({},d,e)}g=Boolean(a(this).find(".redux-font-clear").val()),redux.field_objects.typography.select(b,!0),window.onbeforeunload=null}),a(this).find(".typography-font-multi-style_checkbox_container input").on("change",function(){var b=[];a(this).parent().parent().find("input").each(function(){1==a(this).prop("checked")&&b.push(a(this).val())}),a(this).closest(".typography-multi-style").find(".typography-font-multi-style").val(JSON.stringify(b))}),a(this).find(".redux-typography").on("change",function(){redux.field_objects.typography.select(a(this))}),a(this).find(".redux-typography-size, .redux-typography-height, .redux-typography-word, .redux-typography-letter, .redux-typography-align, .redux-typography-transform, .redux-typography-font-variant, .redux-typography-decoration").keyup(function(){redux.field_objects.typography.select(a(this).parents(".redux-container-typography:first"))}),a(this).find(".redux-typography-color").wpColorPicker({change:function(b,c){a(this).val(c.color.toString()),redux.field_objects.typography.select(a(this).parents(".redux-container-typography:first"))}}),a(this).find(".redux-typography-size").numeric({allowMinus:!1}),a(this).find(".redux-typography-height, .redux-typography-word, .redux-typography-letter").numeric({allowMinus:!0});var f=[{id:"none",text:"none"}];a(this).find(".redux-typography-family").select2({matcher:function(a,b){return 0===b.toUpperCase().indexOf(a.toUpperCase())},query:function(a){return window.Select2.query.local(f)(a)},initSelection:function(a,b){var c={id:a.val(),text:a.val()};b(c)},allowClear:g}).on("select2-opening",function(b){var c=a(this).parents(".redux-container-typography:first").attr("data-id"),d=a("#"+c+" .redux-typography-font-family").data("user-fonts");d=d?1:0;var e=a("#"+c+" .redux-typography-google").val();e=e?1:0;var g=[];if(void 0!==redux.customfonts&&g.push(redux.customfonts),void 0!==redux.stdfonts&&0===d&&g.push(redux.stdfonts),1==d){var h=[];for(var i in redux.typography[c]){var j=redux.typography[c].std_font;for(var k in j)j.hasOwnProperty(k)&&h.push({id:k,text:k,"data-google":"false"})}var l={text:"Standard Fonts",children:h};g.push(l)}(1==e||e===!0&&void 0!==redux.googlefonts)&&g.push(redux.googlefonts),f=g;var m=a("#"+c+" #"+c+"-family").attr("placeholder");m||(m=null),a("#"+c+" .redux-typography-family").select2("val",m)}).on("select2-selecting",function(d,e){var f=d.object.text,g=a(this).parents(".redux-container-typography:first").attr("data-id");a("#"+g+" #"+g+"-family").data("value",f),a("#"+g+" #"+g+"-family").attr("placeholder",f),b=d,c=!0,redux.field_objects.typography.select(a(this).parents(".redux-container-typography:first"))}).on("select2-clearing",function(b,c){var d=a(this).parents(".redux-container-typography:first").attr("data-id");a("#"+d+" #"+d+"-family").attr("data-value",""),a("#"+d+" #"+d+"-family").attr("placeholder","Font Family"),a("#"+d+" #"+d+"-google-font").val("false"),redux.field_objects.typography.select(a(this).parents(".redux-container-typography:first"))});var h=e.find(".redux-typography-family");h.hasClass("redux-typography-family")||e.find(".redux-typography-style").select2(d),e.find(".redux-typography-family-backup, .redux-typography-align, .redux-typography-transform, .redux-typography-font-variant, .redux-typography-decoration").select2(d)})}})},redux.field_objects.typography.size=function(a){var c,b=0;for(c in a)a.hasOwnProperty(c)&&b++;return b},redux.field_objects.typography.makeBool=function(a){return"false"!=a&&"0"!=a&&a!==!1&&0!==a&&("true"==a||"1"==a||a===!0||1==a||void 0)},redux.field_objects.typography.contrastColour=function(a){var b="#444444";if(""!==a){a=a.replace("#","");var c=parseInt(a.substr(0,2),16),d=parseInt(a.substr(2,2),16),e=parseInt(a.substr(4,2),16),f=(299*c+587*d+114*e)/1e3;b=f>=128?"#444444":"#ffffff"}return b},redux.field_objects.typography.select=function(e,f){var g;g=a(e).parents(".redux-container-typography:first").attr("data-id"),void 0===g&&(g=a(e).attr("data-id"));var j=(a(e).parents(".redux-container-typography:first"),a("#"+g+" #"+g+"-family").val());j||(j=null);var k=a("#"+g+" select.redux-typography-family-backup").val(),l=a("#"+g+" .redux-typography-size").val(),m=a("#"+g+" .redux-typography-height").val(),n=a("#"+g+" .redux-typography-word").val(),o=a("#"+g+" .redux-typography-letter").val(),p=a("#"+g+" select.redux-typography-align").val(),q=a("#"+g+" select.redux-typography-transform").val(),r=a("#"+g+" select.redux-typography-font-variant").val(),s=a("#"+g+" select.redux-typography-decoration").val(),t=a("#"+g+" select.redux-typography-style").val(),u=[];if(a("#"+g+" .typography-font-multi-style").length)var u=JSON.parse(a("#"+g+" .typography-font-multi-style").val());var y,v=a("#"+g+" select.redux-typography-subsets").val(),w=a("#"+g+" .redux-typography-color").val(),x=a("#"+g).data("units");c===!0?(y=redux.field_objects.typography.makeBool(b.object["data-google"]),a("#"+g+" .redux-typography-google-font").val(y)):y=redux.field_objects.typography.makeBool(a("#"+g+" .redux-typography-google-font").val()),a("#"+g).hasClass("typography-initialized")||(t=a("#"+g+" select.redux-typography-style").data("value"),v=a("#"+g+" select.redux-typography-subsets").data("value"),""!==t&&(t=String(t)),void 0!==typeof v&&(v=String(v))),void 0===redux.fonts.google&&(y=!1);var z="";if(z=y===!0&&j in redux.fonts.google?redux.fonts.google[j]:{400:"Normal 400",700:"Bold 700","400italic":"Normal 400 Italic","700italic":"Bold 700 Italic"},a(e).hasClass("redux-typography-subsets")&&a("#"+g+" input.typography-subsets").val(v),a(e).hasClass("redux-typography-family")){var A='<option value=""></option>';if(y===!0){var B="";a.each(z.variants,function(a,b){b.id===t||1===redux.field_objects.typography.size(z.variants)?(B=' selected="selected"',t=b.id):B="",A+='<option value="'+b.id+'"'+B+">"+b.name.replace(/\+/g," ")+"</option>"}),a("#"+g+" .redux-typography-style").select2("destroy"),a("#"+g+" .redux-typography-style").html(A),a("#"+g+" .redux-typography-style").select2(d);var C="",D=[];A="",a.each(z.variants,function(b,c){var d="";a.inArray(c.id,u)!==-1||1===redux.field_objects.typography.size(z.variants)?(C=' checked="checked"',t=c.id):C="",d=Math.random(1).toString().substr(2,8)+"_"+c.id,A+='<label for="'+d+'"><input type="checkbox" id="'+d+'" value="'+c.id+'"'+C+"/>"+c.name.replace(/\+/g," ")+"</label>"}),a("#"+g+" .typography-font-multi-style_checkbox_container").html(A),a("#"+g+" .typography-font-multi-style_checkbox_container input").on("change",function(){var b=[];a(this).parent().parent().find("input").each(function(){1==a(this).prop("checked")&&b.push(a(this).val())}),a(this).closest(".typography-multi-style").find(".typography-font-multi-style").val(JSON.stringify(b))}),a("#"+g+" .typography-font-multi-style_checkbox_container").find("input").each(function(){1==a(this).prop("checked")&&D.push(a(this).val())}),a("#"+g+" .typography-font-multi-style").val(JSON.stringify(D)),B="",A='<option value=""></option>',a.each(z.subsets,function(b,c){c.id===v||1===redux.field_objects.typography.size(z.subsets)?(B=' selected="selected"',v=c.id,a("#"+g+" input.typography-subsets").val(v)):B="",A+='<option value="'+c.id+'"'+B+">"+c.name.replace(/\+/g," ")+"</option>"}),a("#"+g+" .redux-typography-subsets").select2("destroy"),a("#"+g+" .redux-typography-subsets").html(A),a("#"+g+" .redux-typography-subsets").select2(d),a("#"+g+" .redux-typography-subsets").parent().fadeIn("fast"),a("#"+g+" .typography-family-backup").fadeIn("fast")}else z&&(a.each(z,function(b,c){b===t||"normal"===b?(B=' selected="selected"',a("#"+g+" .typography-style .select2-chosen").text(c)):B="",A+='<option value="'+b+'"'+B+">"+c.replace("+"," ")+"</option>"}),a("#"+g+" .redux-typography-style").select2("destroy"),a("#"+g+" .redux-typography-style").html(A),a("#"+g+" .redux-typography-style").select2(d),a("#"+g+" .redux-typography-subsets").parent().fadeOut("fast"),a("#"+g+" .typography-family-backup").fadeOut("fast"));a("#"+g+" .redux-typography-font-family").val(j)}else a(e).hasClass("redux-typography-family-backup")&&""!==k&&a("#"+g+" .redux-typography-font-family-backup").val(k);0===a("#"+g+" select.redux-typography-style option[value='"+t+"']").length?(t="",a("#"+g+" select.redux-typography-style").select2("val","")):"400"===t&&a("#"+g+" select.redux-typography-style").select2("val",t),0===a("#"+g+" select.redux-typography-subsets option[value='"+v+"']").length&&(v="",a("#"+g+" select.redux-typography-subsets").select2("val",""),a("#"+g+" input.typography-subsets").val(v));var E="style_link_"+g;if(a("."+E).remove(),null!==j&&"inherit"!==j&&a("#"+g).hasClass("typography-initialized")){var F=j.replace(/\s+/g,"+");if(y===!0){var G=F;t&&""!==t&&(G+=":"+t.replace(/\-/g," ")),v&&""!==v&&(G+="&subset="+v),c===!1&&"undefined"!=typeof WebFont&&WebFont&&WebFont.load({google:{families:[G]}}),a("#"+g+" .redux-typography-google").val(!0)}else a("#"+g+" .redux-typography-google").val(!1)}if(t.indexOf("italic")!==-1?(a("#"+g+" .typography-preview").css("font-style","italic"),a("#"+g+" .typography-font-style").val("italic"),t=t.replace("italic","")):(a("#"+g+" .typography-preview").css("font-style","normal"),a("#"+g+" .typography-font-style").val("")),a("#"+g+" .typography-font-weight").val(t),m||(m=l),""===l||void 0===l?a("#"+g+" .typography-font-size").val(""):a("#"+g+" .typography-font-size").val(l+x),""===m||void 0===m?a("#"+g+" .typography-line-height").val(""):a("#"+g+" .typography-line-height").val(m+x),""===n||void 0===n?a("#"+g+" .typography-word-spacing").val(""):a("#"+g+" .typography-word-spacing").val(n+x),""===o||void 0===o?a("#"+g+" .typography-letter-spacing").val(""):a("#"+g+" .typography-letter-spacing").val(o+x),a("#"+g).hasClass("typography-initialized")){var H=a("#"+g+" .typography-preview").data("preview-size");"0"==H&&a("#"+g+" .typography-preview").css("font-size",l+x),a("#"+g+" .typography-preview").css("font-weight",t),a("#"+g+" .typography-preview").css("font-family",j+", sans-serif"),"none"===j&&""===j&&a("#"+g+" .typography-preview").css("font-family","inherit"),a("#"+g+" .typography-preview").css("line-height",m+x),a("#"+g+" .typography-preview").css("word-spacing",n+x),a("#"+g+" .typography-preview").css("letter-spacing",o+x),w&&(a("#"+g+" .typography-preview").css("color",w),a("#"+g+" .typography-preview").css("background-color",redux.field_objects.typography.contrastColour(w))),a("#"+g+" .typography-style .select2-chosen").text(a("#"+g+" .redux-typography-style option:selected").text()),a("#"+g+" .typography-script .select2-chosen").text(a("#"+g+" .redux-typography-subsets option:selected").text()),p&&a("#"+g+" .typography-preview").css("text-align",p),q&&a("#"+g+" .typography-preview").css("text-transform",q),r&&a("#"+g+" .typography-preview").css("font-variant",r),s&&a("#"+g+" .typography-preview").css("text-decoration",s),a("#"+g+" .typography-preview").slideDown()}a("#"+g).hasClass("typography-initialized")||a("#"+g).addClass("typography-initialized"),c=!1,f||redux_change(e)}}(jQuery);